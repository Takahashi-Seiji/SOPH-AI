<div class="row p-2">
  <div class="col-8 lecture-summary p-5">
    <h1 id="lecture-title", class="mb-4 text-center" style="text-decoration: underline";><%= @lecture.title %></h1>
    <h2 id="lecture-content"><%= simple_format(@lecture.summary) %></h2>
  </div>

  <div class="col-4">
    <h1 class="text-center">Notes</h1>
      <div data-lecture-target="notes" class="notes-container p-4 mb-4">
        <div>
          <% @notes.each do |note| %>
            <h4><%= simple_format(note.content) %></h4>
          <% end %>
        </div>
      </div>
      <div class="text-center">
        <button data-action="click->lecture#displayNoteForm" data-lecture-target="addNoteButton" class="mb-3 text-center note-btn"><strong>Take note</strong></button>
        <button data-action="click->lecture#displayEditNoteForm" class="text-center note-btn"><strong>Edit your notes</strong></button>
      </div>
      <div class="d-none" data-lecture-target="noteForm">
        <%= simple_form_for [@lecture, Note.new], remote: true, data: {action: "submit->lecture#addNote"} do |f| %>
          <%= f.text_area :content, as: :text, data: {lecture_target: "noteContent"}, class:"note-input" %>
          <%= f.button :submit, "Save Note", class:"note-btn" %>
        <% end %>
      </div>
      <div class="d-none" data-lecture-target="editNoteForm">
        <%= simple_form_for [@lecture, @note], remote: true, data: {action: "submit->lecture#editNote"} do |f| %>
          <%= f.text_area :content, as: :text, data: {lecture_target: "noteContent"}, class:"note-input mt-3" %>
          <%= f.button :submit, "Update Note", class:"note-btn" %>
        <% end %>
      </div>

    <div data-controller="chat" data-chat-chat-id-value="<%= @chat.id %>" class="p-3">
        <h1>Chat with Soph.AI</h1>
      <div data-chat-target="conversationDisplay" class="conversation-chat mb-3">
        <%= turbo_frame_tag "messages" do %>
          <%= render 'chat' %>
        <% end %>
      </div>
      <%= simple_form_for [@lecture, @chat, Message.new], remote: true, data: {action: "submit->chat#message", "chat_chat_id": @chat.id} do |f| %>
        <%= f.text_area :content, as: :text, placeholder: "Your message...", data: {chat_target: "messageContent"}, class:"chat-input" %>
        <%= f.button :submit, "Send Message", class:"note-btn" %>
      <% end %>
    </div>
    <div class="text-center mt-5">
      <% if current_user.student? && @lecture.quiz_for_student(current_user)&.status == "created" %>
        <%= turbo_frame_tag "quizz" do %>
          <%= render 'student_quiz' %>
        <% end %>
      <% elsif  @lecture.quiz_for_student(current_user)&.status == "submitted" %>
        <%= turbo_frame_tag id=dom_id(@lecture) do %>
          <%= render 'results', quiz: @lecture.quiz_for_student(current_user), lecture: @lecture %>
        <% end %>
      <% end %>
      <% if @submitted_quizzes_count < 5 %>
        <%= button_to 'Generate Quiz', lecture_quizzes_path(@lecture), data: {turbo_method: :post} %>
      <% end %>
    </div>
  </div>
</div>
